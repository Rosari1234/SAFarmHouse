{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/H%20P/Desktop/sa-farmshop/lib/mongodb.ts"],"sourcesContent":["\nimport { MongoClient } from 'mongodb';\n\n// Replace the URI below with your actual MongoDB Atlas connection string\nconst uri = process.env.MONGODB_URI;\n\nif (!uri) {\n  throw new Error('Please add your MongoDB URI to .env.local as MONGODB_URI');\n}\n\nlet client: MongoClient;\nlet clientPromise: Promise<MongoClient>;\n\nif (process.env.NODE_ENV === 'development') {\n  if (!(global as any)._mongoClientPromise) {\n    client = new MongoClient(uri);\n    (global as any)._mongoClientPromise = client.connect();\n  }\n  clientPromise = (global as any)._mongoClientPromise;\n} else {\n  client = new MongoClient(uri);\n  clientPromise = client.connect();\n}\n\nexport default clientPromise;\n"],"names":[],"mappings":";;;;AACA;;AAEA,yEAAyE;AACzE,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AAEnC,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,IAAI,CAAC,yDAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,oKAAW,CAAC;QACzB,yDAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,yDAAgB,mBAAmB;AACrD;;uCAKe"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/H%20P/Desktop/sa-farmshop/app/api/transactions/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { ObjectId } from 'mongodb';\nimport clientPromise from '../../../lib/mongodb';\n\nconst DB_NAME = \"farmshop\";\nconst COLLECTION_NAME = \"transactions\";\n\nexport async function GET() {\n  try {\n    const client = await clientPromise;\n    const db = client.db(DB_NAME);\n    const transactions = await db.collection(COLLECTION_NAME)\n      .find({})\n      .sort({ createdAt: -1 })\n      .toArray();\n\n    // Get all unique dealer IDs\n    const dealerIds = [...new Set(transactions.map(t => t.dealerId).filter(id => id))];\n    const dealers = dealerIds.length > 0 ? await db.collection('dealers')\n      .find({ _id: { $in: dealerIds.map(id => new ObjectId(id)) } })\n      .toArray() : [];\n\n    // Create dealer name map\n    const dealerMap = new Map(dealers.map(d => [d._id.toString(), d.name]));\n\n    // Map _id to id and add dealerName\n    const formatted = transactions.map(t => ({\n      ...t,\n      id: t._id.toString(),\n      dealerName: dealerMap.get(t.dealerId) || 'Unknown Dealer',\n      _id: undefined\n    }));\n\n    return NextResponse.json(formatted);\n  } catch (e) {\n    console.error(e);\n    return NextResponse.json({ error: 'Failed to fetch' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const client = await clientPromise;\n    const db = client.db(DB_NAME);\n    \n    const newTransaction = {\n      ...body,\n      totalAmount: body.weightKg * body.pricePerKg,\n      createdAt: Date.now(),\n      isPaid: body.isPaid || false\n    };\n\n    const result = await db.collection(COLLECTION_NAME).insertOne(newTransaction);\n    \n    // Get dealer name for the response\n    let dealerName = 'Unknown Dealer';\n    if (body.dealerId) {\n      try {\n        const dealer = await db.collection('dealers').findOne({ _id: new ObjectId(body.dealerId) });\n        if (dealer) dealerName = dealer.name;\n      } catch (e) {\n        console.error('Failed to fetch dealer name:', e);\n      }\n    }\n    \n    return NextResponse.json({\n      ...newTransaction,\n      id: result.insertedId.toString(),\n      dealerName\n    });\n  } catch (e) {\n    console.error(e);\n    return NextResponse.json({ error: 'Failed to save' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AACA;AACA;AACA;;;;AAEA,MAAM,UAAU;AAChB,MAAM,kBAAkB;AAEjB,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,2HAAa;QAClC,MAAM,KAAK,OAAO,EAAE,CAAC;QACrB,MAAM,eAAe,MAAM,GAAG,UAAU,CAAC,iBACtC,IAAI,CAAC,CAAC,GACN,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE,GACrB,OAAO;QAEV,4BAA4B;QAC5B,MAAM,YAAY;eAAI,IAAI,IAAI,aAAa,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAA,KAAM;SAAK;QAClF,MAAM,UAAU,UAAU,MAAM,GAAG,IAAI,MAAM,GAAG,UAAU,CAAC,WACxD,IAAI,CAAC;YAAE,KAAK;gBAAE,KAAK,UAAU,GAAG,CAAC,CAAA,KAAM,IAAI,iKAAQ,CAAC;YAAK;QAAE,GAC3D,OAAO,KAAK,EAAE;QAEjB,yBAAyB;QACzB,MAAM,YAAY,IAAI,IAAI,QAAQ,GAAG,CAAC,CAAA,IAAK;gBAAC,EAAE,GAAG,CAAC,QAAQ;gBAAI,EAAE,IAAI;aAAC;QAErE,mCAAmC;QACnC,MAAM,YAAY,aAAa,GAAG,CAAC,CAAA,IAAK,CAAC;gBACvC,GAAG,CAAC;gBACJ,IAAI,EAAE,GAAG,CAAC,QAAQ;gBAClB,YAAY,UAAU,GAAG,CAAC,EAAE,QAAQ,KAAK;gBACzC,KAAK;YACP,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;IACvE;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,SAAS,MAAM,2HAAa;QAClC,MAAM,KAAK,OAAO,EAAE,CAAC;QAErB,MAAM,iBAAiB;YACrB,GAAG,IAAI;YACP,aAAa,KAAK,QAAQ,GAAG,KAAK,UAAU;YAC5C,WAAW,KAAK,GAAG;YACnB,QAAQ,KAAK,MAAM,IAAI;QACzB;QAEA,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,iBAAiB,SAAS,CAAC;QAE9D,mCAAmC;QACnC,IAAI,aAAa;QACjB,IAAI,KAAK,QAAQ,EAAE;YACjB,IAAI;gBACF,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,WAAW,OAAO,CAAC;oBAAE,KAAK,IAAI,iKAAQ,CAAC,KAAK,QAAQ;gBAAE;gBACzF,IAAI,QAAQ,aAAa,OAAO,IAAI;YACtC,EAAE,OAAO,GAAG;gBACV,QAAQ,KAAK,CAAC,gCAAgC;YAChD;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,GAAG,cAAc;YACjB,IAAI,OAAO,UAAU,CAAC,QAAQ;YAC9B;QACF;IACF,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACtE;AACF"}}]
}