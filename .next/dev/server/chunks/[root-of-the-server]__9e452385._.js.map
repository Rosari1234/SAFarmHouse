{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/H%20P/Desktop/SAFarmHouse/lib/mongodb.ts"],"sourcesContent":["\r\nimport { MongoClient } from 'mongodb';\r\n\r\n// Replace the URI below with your actual MongoDB Atlas connection string\r\nconst uri = process.env.MONGODB_URI;\r\n\r\nif (!uri) {\r\n  throw new Error('Please add your MongoDB URI to .env.local as MONGODB_URI');\r\n}\r\n\r\nlet client: MongoClient;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n  // In development mode, use a global variable so that the value\r\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n  if (!(global as any)._mongoClientPromise) {\r\n    client = new MongoClient(uri);\r\n    (global as any)._mongoClientPromise = client.connect();\r\n  }\r\n  clientPromise = (global as any)._mongoClientPromise;\r\n} else {\r\n  // In production mode, it's best to not use a global variable.\r\n  client = new MongoClient(uri, {\r\n    // Options for serverless environments\r\n    maxPoolSize: 1, // Maintain up to 1 connection per lambda\r\n    serverSelectionTimeoutMS: 5000, // Keep trying to send operations for 5 seconds\r\n    socketTimeoutMS: 45000, // Close sockets after 45 seconds of inactivity\r\n  });\r\n  clientPromise = client.connect();\r\n}\r\n\r\nexport default clientPromise;\r\n"],"names":[],"mappings":";;;;AACA;;AAEA,yEAAyE;AACzE,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AAEnC,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,yDAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,oKAAW,CAAC;QACzB,yDAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,yDAAgB,mBAAmB;AACrD;;uCAWe"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/H%20P/Desktop/SAFarmHouse/app/api/transactions/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { ObjectId } from 'mongodb';\r\nimport clientPromise from '../../../../lib/mongodb';\r\n\r\nconst DB_NAME = \"farmshop\";\r\nconst COLLECTION_NAME = \"transactions\";\r\n\r\nexport async function PATCH(request: Request, { params }: { params: any }) {\r\n  try {\r\n    const resolvedParams = await params;\r\n    const id = resolvedParams.id;\r\n    const body = await request.json();\r\n    const client = await clientPromise;\r\n    const db = client.db(DB_NAME);\r\n\r\n    const { isPaid } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: 'Missing transaction ID' }, { status: 400 });\r\n    }\r\n\r\n    let objectId;\r\n    try {\r\n      objectId = new ObjectId(id);\r\n    } catch (e) {\r\n      console.error('Invalid ObjectId:', id, e);\r\n      return NextResponse.json({ error: 'Invalid transaction ID format' }, { status: 400 });\r\n    }\r\n\r\n    const result = await db.collection(COLLECTION_NAME).updateOne(\r\n      { _id: objectId },\r\n      { $set: { isPaid } }\r\n    );\r\n\r\n    if (result.matchedCount === 0) {\r\n      console.error('Transaction not found:', id);\r\n      return NextResponse.json({ error: 'Transaction not found' }, { status: 404 });\r\n    }\r\n\r\n    console.log('Updated transaction:', id, 'isPaid:', isPaid);\r\n    return NextResponse.json({ success: true });\r\n  } catch (e) {\r\n    console.error('PATCH error:', e);\r\n    return NextResponse.json({ error: 'Failed to update payment status' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(request: Request, { params }: { params: any }) {\r\n  try {\r\n    const resolvedParams = await params;\r\n    const id = resolvedParams.id;\r\n    const body = await request.json();\r\n    const client = await clientPromise;\r\n    const db = client.db(DB_NAME);\r\n\r\n    const updateData = {\r\n      dealerId: body.dealerId,\r\n      date: body.date,\r\n      chickenCount: body.chickenCount,\r\n      weightKg: body.weightKg,\r\n      pricePerKg: body.pricePerKg,\r\n      totalAmount: body.weightKg * body.pricePerKg,\r\n      isPaid: body.isPaid || false,\r\n      note: body.note || ''\r\n    };\r\n\r\n    let objectId;\r\n    try {\r\n      objectId = new ObjectId(id);\r\n    } catch (e) {\r\n      return NextResponse.json({ error: 'Invalid transaction ID' }, { status: 400 });\r\n    }\r\n\r\n    const result = await db.collection(COLLECTION_NAME).updateOne(\r\n      { _id: objectId },\r\n      { $set: updateData }\r\n    );\r\n\r\n    if (result.matchedCount === 0) {\r\n      return NextResponse.json({ error: 'Transaction not found' }, { status: 404 });\r\n    }\r\n\r\n    // Fetch the updated document\r\n    const updatedDoc = await db.collection(COLLECTION_NAME).findOne({ _id: objectId });\r\n    \r\n    // Get dealer name for the response\r\n    let dealerName = 'Unknown Dealer';\r\n    if (updatedDoc.dealerId) {\r\n      try {\r\n        const dealer = await db.collection('dealers').findOne({ _id: new ObjectId(updatedDoc.dealerId) });\r\n        if (dealer) dealerName = dealer.name;\r\n      } catch (e) {\r\n        console.error('Failed to fetch dealer name:', e);\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      ...updatedDoc,\r\n      id: updatedDoc._id.toString(),\r\n      dealerName,\r\n      _id: undefined\r\n    });\r\n  } catch (e) {\r\n    console.error(e);\r\n    return NextResponse.json({ error: 'Failed to update' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: Request, { params }: { params: any }) {\r\n  try {\r\n    const resolvedParams = await params;\r\n    const id = resolvedParams.id;\r\n    const client = await clientPromise;\r\n    const db = client.db(DB_NAME);\r\n\r\n    let objectId;\r\n    try {\r\n      objectId = new ObjectId(id);\r\n    } catch (e) {\r\n      return NextResponse.json({ error: 'Invalid transaction ID' }, { status: 400 });\r\n    }\r\n\r\n    const result = await db.collection(COLLECTION_NAME).deleteOne(\r\n      { _id: objectId }\r\n    );\r\n\r\n    if (result.deletedCount === 0) {\r\n      return NextResponse.json({ error: 'Transaction not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (e) {\r\n    console.error(e);\r\n    return NextResponse.json({ error: 'Failed to delete' }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":"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"}}]
}